services:
  data-loading:
    build:
      context: .
    container_name: data_loading_service
    environment:
      - PYTHONUNBUFFERED=1
      - PYTHONPATH=/app/src
    working_dir: /app
    volumes:
      - ./src:/app/src:rw
      - ./data:/app/data:rw
      - ./models:/app/models:rw
    command: >
      python -u -m src.data_loading
      --year 2023
      --data_dir /app/data
      --utils_dir /app/src/utils
    restart: "no"

  model-production:
    build:
      context: .
    container_name: model_production_service
    environment:
      - PYTHONUNBUFFERED=1
      - PYTHONPATH=/app/src
    working_dir: /app
    volumes:
      - ./src:/app/src:rw
      - ./data:/app/data:rw
      - ./models:/app/models:rw
    command: >
      python -u -m src.model_production_main
      --year 24
      --data_file /app/data/DATA.csv
    restart: "no"

  metabase:
    image: metabase/metabase:v0.54.8
    container_name: metabase-dev
    ports:
      - "3000:3000"           
    environment:
      # Où Metabase stocke sa base interne (H2) À L’INTÉRIEUR du conteneur
      MB_DB_FILE: /metabase-data/metabase.db
    volumes:
      # Base interne (dashboards, utilisateurs, etc.)
      - ./metabase-data:/metabase-data
      # Fichier de données métier monté en lecture seule
      - ./data/traces_metabase.db:/data/traces_metabase.db:ro
